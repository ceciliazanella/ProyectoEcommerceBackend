<main class="login-container">

  <h3 class="login-title">Ingres√° a tu Chococuenta! üîê</h3>

  <div id="error-message" class="error-message" style="display:none;"></div>

  <form id="login-form" action="javascript:void(0);" class="login-form">

    <label for="email" class="form-label">Correo Electr√≥nico üíå</label>
    <input type="email" id="email" name="email" class="form-input" required
      placeholder="Ingres√° tu Correo Electr√≥nico..." />

    <label for="password" class="form-label">Contrase√±a üîë</label>
    <div class="password-container">
      <input type="password" id="password" name="password" class="form-input" required
        placeholder="Ingres√° tu Contrase√±a..." />
      <span id="toggle-password" class="eye-icon">&#128065;</span>
    </div>

    <button type="submit" class="submit-btn">Inici√° tu Chocosesi√≥n! ü•ß</button>

  </form>

  <div class="register-link">
    <p>¬øTodav√≠a no ten√©s tu Chococuenta? üéÇ <a href="/register" class="register-link-text">Registrate Ac√°! üç™</a></p>
  </div>

</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const loginForm = document.getElementById('login-form');

    const errorMessageDiv = document.getElementById('error-message');

    const togglePassword = document.getElementById('toggle-password');

    if (loginForm) {
      loginForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        errorMessageDiv.style.display = 'none';

        const email = document.getElementById('email').value;

        const password = document.getElementById('password').value;

        try {
          const response = await fetch('/api/sessions/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();
          if (response.ok) {
            localStorage.setItem('cartId', data.cartId);
            localStorage.setItem('role', data.role);

            window.location.replace(data.role === 'admin' ? '/products' : '/');
          } else {
            errorMessageDiv.style.display = 'block';
            errorMessageDiv.innerHTML = data.message || '‚ùå Hubo un error al querer Iniciar tu Chocosesi√≥n...';
          }
        } catch (error) {
          console.error('Error:', error);
          errorMessageDiv.style.display = 'block';
          errorMessageDiv.innerHTML = '‚ùå Hubo un Problema al querer Iniciar tu Chocosesi√≥n...';
        }
      });
    }

    if (togglePassword) {
      togglePassword.addEventListener('click', function () {
        const passwordField = document.getElementById('password');
        
        passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
        togglePassword.innerHTML = passwordField.type === 'password' ? '&#128065;' : '&#128064;';
      });
    }
  });
</script>
