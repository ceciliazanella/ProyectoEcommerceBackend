<main class="login-container">

  <h3 class="login-title">IngresÃ¡ a tu Chococuenta! ğŸ”</h3>

  <div id="error-message" class="error-message" style="display:none;"></div>

  <form id="login-form" action="javascript:void(0);" class="login-form">

    <label for="email" class="form-label">Correo ElectrÃ³nico ğŸ’Œ</label>
    <input type="email" id="email" name="email" class="form-input" required
      placeholder="IngresÃ¡ tu Correo ElectrÃ³nico..." />

    <label for="password" class="form-label">ContraseÃ±a ğŸ”‘</label>
    <div class="password-container">
      <input type="password" id="password" name="password" class="form-input" required
        placeholder="IngresÃ¡ tu ContraseÃ±a..." />
      <span id="toggle-password" class="eye-icon">&#128065;</span>
    </div>

    <button type="submit" class="submit-btn">IniciÃ¡ tu ChocosesiÃ³n! ğŸ¥§</button>

  </form>

  <div class="register-link">
    <p>Â¿TodavÃ­a no tenÃ©s tu Chococuenta? ğŸ‚ <a href="/register" class="register-link-text">Registrate AcÃ¡! ğŸª</a></p>
  </div>

</main>

<script>
  document.getElementById('login-form').addEventListener('submit', async function (e) {
    e.preventDefault();

    const errorMessageDiv = document.getElementById('error-message');

    errorMessageDiv.style.display = 'none';

    const email = document.getElementById('email').value;

    const password = document.getElementById('password').value;

    try {
      const response = await fetch('/api/sessions/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, password }),
      });

      const data = await response.json();
      if (response.ok) {
        localStorage.setItem('cartId', data.cartId);

        localStorage.setItem('role', data.role);

        if (data.role === 'admin') {
          window.location.replace('/products');
        } else {
          window.location.replace('/');
        }
      } else {
        errorMessageDiv.style.display = 'block';
        errorMessageDiv.innerHTML = data.message || 'âŒ Hubo un error al querer Iniciar tu ChocosesiÃ³n...';
      }
    } catch (error) {
      console.error('Error:', error);
      errorMessageDiv.style.display = 'block';
      errorMessageDiv.innerHTML = 'âŒ Hubo un Problema al querer Iniciar tu ChocosesiÃ³n...';
    }
  });

  document.getElementById('toggle-password').addEventListener('click', function () {
    const passwordField = document.getElementById('password');

    const icon = document.getElementById('toggle-password');

    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      icon.innerHTML = '&#128064;';
    } else {
      passwordField.type = 'password';
      icon.innerHTML = '&#128065;';
    }
  });
</script>